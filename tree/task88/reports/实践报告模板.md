# Go-Ethereum 实践操作报告

**作业编号：** Task88  
**提交日期：** 2025年10月  
**实践主题：** Geth节点搭建与智能合约部署实践  

---

## 一、实践环境准备

### 1.1 系统环境

| 项目 | 信息 | 备注 |
|------|------|------|
| 操作系统 | _填写，如：Windows 11_ | |
| Go版本 | _填写，如：go1.21.0_ | |
| CPU | _填写_ | |
| 内存 | _填写_ | |
| 磁盘空间 | _填写_ | |

### 1.2 软件准备

- [ ] Go语言环境安装
- [ ] Git版本控制工具
- [ ] Node.js环境（用于Web3.js测试）
- [ ] Solidity编译器（solc）

**安装验证截图：**

```
请在此处插入以下命令的截图：
1. go version
2. git --version
3. node --version
4. solc --version
```

📷 **截图1：环境验证**
> [在此粘贴截图或说明截图文件路径]

---

## 二、编译Geth（10分）

### 2.1 克隆源码

**执行命令：**
```bash
git clone https://github.com/ethereum/go-ethereum.git
cd go-ethereum
git checkout v1.13.5
```

**操作记录：**
```
[请粘贴命令输出]
```

📷 **截图2：源码克隆成功**

### 2.2 编译过程

**编译命令：**
```bash
# Linux/macOS
e

# Windows
go build -o geth.exe ./cmd/geth
```

**编译输出：**
```
[请粘贴编译日志]
```

**遇到的问题与解决：**
| 问题 | 解决方案 |
|------|----------|
| _如：CGO_ENABLED错误_ | _解决方法_ |

📷 **截图3：编译成功输出**

### 2.3 验证编译结果

**版本查询：**
```bash
./build/bin/geth version
```

**输出示例：**
```
Geth
Version: 1.13.5-stable
Architecture: amd64
Go Version: go1.21.0
Operating System: linux
```

📷 **截图4：Geth版本信息**

**评分点：**
- [x] 成功克隆源码
- [x] 编译无错误
- [x] 版本信息正确显示

---

## 三、搭建私有链（20分）

### 3.1 创建创世配置

**创世文件（genesis.json）：**
```json
{
  "config": {
    "chainId": 88888,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0,
    "petersburgBlock": 0,
    "istanbulBlock": 0,
    "berlinBlock": 0,
    "londonBlock": 0,
    "clique": {
      "period": 5,
      "epoch": 30000
    }
  },
  "difficulty": "1",
  "gasLimit": "8000000000",
  "alloc": {
    "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb0": {
      "balance": "1000000000000000000000000"
    }
  }
}
```

**配置说明：**
- **chainId**: _填写你选择的链ID及原因_
- **clique**: _说明选择PoA的原因_
- **alloc**: _预分配账户及余额_

### 3.2 初始化区块链

**执行命令：**
```bash
./build/bin/geth --datadir ./mychain init genesis.json
```

**初始化输出：**
```
[请粘贴初始化日志]

示例：
INFO [10-19|13:00:00.000] Successfully wrote genesis state
```

📷 **截图5：区块链初始化成功**

### 3.3 启动节点

**启动命令：**
```bash
./build/bin/geth \
  --datadir ./mychain \
  --networkid 88888 \
  --http \
  --http.addr "0.0.0.0" \
  --http.port 8545 \
  --http.api "eth,web3,personal,net,debug" \
  --http.corsdomain "*" \
  --ws \
  --ws.port 8546 \
  --allow-insecure-unlock \
  console
```

**启动日志：**
```
[请粘贴启动日志前20行]

应包含：
- INFO [..] Starting Geth on Ethereum mainnet...
- INFO [..] IPC endpoint opened
- INFO [..] HTTP server started
```

📷 **截图6：节点启动成功**

**评分点：**
- [x] 创世文件配置合理
- [x] 初始化成功
- [x] 节点正常启动
- [x] RPC服务已开启

---

## 四、控制台操作验证（30分）

### 4.1 基础查询

**操作记录：**

| 命令 | 输出结果 | 截图编号 |
|------|---------|---------|
| `eth.blockNumber` | _填写当前区块高度_ | 截图7 |
| `eth.accounts` | _填写账户列表_ | 截图7 |
| `eth.getBalance(eth.accounts[0])` | _填写余额（wei）_ | 截图7 |
| `web3.fromWei(eth.getBalance(eth.accounts[0]), "ether")` | _填写余额（ether）_ | 截图7 |
| `net.version` | _填写网络ID_ | 截图7 |
| `admin.nodeInfo.name` | _填写节点名称_ | 截图7 |

📷 **截图7：基础查询命令**

```javascript
// 完整操作示例
> eth.blockNumber
0

> eth.accounts
["0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb0"]

> web3.fromWei(eth.getBalance(eth.accounts[0]), "ether")
"1000000"
```

### 4.2 挖矿测试

**操作步骤：**

1. **检查挖矿状态**
```javascript
> eth.mining
false
```

2. **启动挖矿**
```javascript
> miner.start(1)
null
```

3. **等待10秒后检查**
```javascript
> eth.blockNumber
15  // 示例值

> eth.mining
true
```

4. **停止挖矿**
```javascript
> miner.stop()
true
```

📷 **截图8：挖矿前后区块高度对比**

**挖矿数据：**
- 挖矿线程数：_填写_
- 挖矿前区块高度：_填写_
- 挖矿后区块高度：_填写_
- 平均出块时间：_填写_

### 4.3 账户操作

**创建新账户：**
```javascript
> personal.newAccount("password123")
"0xabcd1234..."  // 新账户地址
```

**查看账户列表：**
```javascript
> eth.accounts
["0x742d...", "0xabcd..."]
```

📷 **截图9：创建账户成功**

**评分点：**
- [x] 查询区块高度成功
- [x] 挖矿功能正常
- [x] 创建账户成功

---

## 五、交易操作实践（20分）

### 5.1 发送Ether交易

**准备工作：**
```javascript
var sender = eth.accounts[0]
var receiver = eth.accounts[1]  // 或新创建的账户
```

**查看初始余额：**
```javascript
> web3.fromWei(eth.getBalance(sender), "ether")
"1000000"  // 示例

> web3.fromWei(eth.getBalance(receiver), "ether")
"0"
```

**解锁账户：**
```javascript
> personal.unlockAccount(sender, "password", 300)
true
```

**发送交易：**
```javascript
> eth.sendTransaction({
    from: sender,
    to: receiver,
    value: web3.toWei(10, "ether"),
    gas: 21000,
    gasPrice: web3.toWei(1, "gwei")
})
"0x1234abcd5678ef..."  // 交易哈希
```

📷 **截图10：交易发送成功**

**查询交易详情：**
```javascript
> eth.getTransaction("0x1234abcd...")
{
  blockHash: "0x...",
  blockNumber: 123,
  from: "0x742d...",
  to: "0xabcd...",
  value: 10000000000000000000,
  gas: 21000,
  gasPrice: 1000000000,
  hash: "0x1234abcd...",
  nonce: 0
}
```

📷 **截图11：交易详情**

**查询交易收据：**
```javascript
> eth.getTransactionReceipt("0x1234abcd...")
{
  blockNumber: 123,
  gasUsed: 21000,
  status: "0x1",  // 成功
  transactionHash: "0x1234abcd..."
}
```

**验证余额变化：**
```javascript
> web3.fromWei(eth.getBalance(receiver), "ether")
"10"  // 增加了10 ETH
```

📷 **截图12：余额变化确认**

**交易数据汇总：**
| 项目 | 数值 |
|------|------|
| 发送方地址 | _填写_ |
| 接收方地址 | _填写_ |
| 转账金额 | _填写_ ETH |
| Gas Limit | _填写_ |
| Gas Price | _填写_ Gwei |
| Gas Used | _填写_ |
| 交易哈希 | _填写_ |
| 区块号 | _填写_ |

**评分点：**
- [x] 交易发送成功
- [x] 交易被打包
- [x] 余额变化正确

---

## 六、智能合约部署（20分）

### 6.1 合约编译

**Solidity合约（SimpleStorage.sol）：**
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract SimpleStorage {
    uint256 private storedData;
    
    event DataStored(uint256 data);
    
    function set(uint256 x) public {
        storedData = x;
        emit DataStored(x);
    }
    
    function get() public view returns (uint256) {
        return storedData;
    }
}
```

**编译命令：**
```bash
solc --abi --bin SimpleStorage.sol
```

**编译输出：**
```
[请粘贴ABI和Bytecode]

示例：
======= SimpleStorage.sol:SimpleStorage =======
Binary:
608060405234801561001057600080fd5b50...

ABI:
[{"inputs":[{"internalType":"uint256"...}]
```

📷 **截图13：合约编译成功**

### 6.2 部署合约

**准备部署数据：**
```javascript
var abi = [...]  // 粘贴ABI
var bytecode = "0x608060..."  // 粘贴Bytecode

var SimpleStorage = eth.contract(abi)
```

**部署合约：**
```javascript
var contract = SimpleStorage.new({
    from: eth.accounts[0],
    data: bytecode,
    gas: 1000000
}, function(err, contract) {
    if (err) {
        console.log("Error:", err)
    } else if (contract.address) {
        console.log("Contract deployed at:", contract.address)
    }
})
```

**等待挖矿确认...**

📷 **截图14：合约部署交易**

**合约地址：**
```javascript
> contract.address
"0x5678..."
```

📷 **截图15：合约地址确认**

**部署数据汇总：**
| 项目 | 数值 |
|------|------|
| 合约名称 | SimpleStorage |
| 合约地址 | _填写_ |
| 部署者地址 | _填写_ |
| 部署交易哈希 | _填写_ |
| Gas Used | _填写_ |
| 区块号 | _填写_ |

### 6.3 调用合约

**读取数据（Call）：**
```javascript
> contract.get()
0  // 初始值
```

**写入数据（Transaction）：**
```javascript
> contract.set(42, {from: eth.accounts[0], gas: 100000})
"0xtxhash..."
```

**等待确认后再次读取：**
```javascript
> contract.get()
42
```

📷 **截图16：合约调用成功**

**查看事件日志：**
```javascript
> eth.getTransactionReceipt("0xtxhash...").logs
[{
  address: "0x5678...",
  topics: ["0x..."],
  data: "0x000...02a"  // 42的十六进制
}]
```

📷 **截图17：事件日志**

**评分点：**
- [x] 合约编译成功
- [x] 合约部署成功
- [x] 合约调用正常
- [x] 事件日志正确

---

## 七、外部工具连接测试（10分）

### 7.1 使用curl测试RPC

**测试命令：**
```bash
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}' \
  http://127.0.0.1:8545
```

**输出结果：**
```json
[请粘贴输出]

示例：
{"jsonrpc":"2.0","id":1,"result":"0x1f"}
```

📷 **截图18：curl RPC测试**

### 7.2 使用Web3.js连接

**测试脚本（test.js）：**
```javascript
const Web3 = require('web3');
const web3 = new Web3('http://127.0.0.1:8545');

async function main() {
    const blockNumber = await web3.eth.getBlockNumber();
    console.log('Current block:', blockNumber);
    
    const accounts = await web3.eth.getAccounts();
    console.log('Accounts:', accounts);
}

main();
```

**执行结果：**
```
[请粘贴输出]

示例：
Current block: 31
Accounts: [ '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb0' ]
```

📷 **截图19：Web3.js连接成功**

**评分点：**
- [x] curl测试成功
- [x] Web3.js连接成功

---

## 八、区块浏览器查询（10分）

### 8.1 本地区块浏览器搭建（可选）

**使用工具：** _如：ethstats, ethereum-explorer_

📷 **截图20：区块浏览器界面**

### 8.2 控制台查询区块信息

**查询最新区块：**
```javascript
> eth.getBlock('latest')
{
  difficulty: 1,
  extraData: "0x...",
  gasLimit: 8000000000,
  gasUsed: 21000,
  hash: "0x...",
  number: 50,
  parentHash: "0x...",
  timestamp: 1729315200,
  transactions: ["0x1234..."],
  ...
}
```

📷 **截图21：区块详细信息**

**查询交易信息：**
```javascript
> eth.getTransactionByHash("0x1234...")
```

📷 **截图22：交易详细信息**

---

## 九、实践总结

### 9.1 完成情况检查清单

- [x] 成功编译Geth
- [x] 启动开发链并查看版本
- [x] 使用控制台查询区块高度
- [x] 启动和停止挖矿
- [x] 创建新账户并查看余额
- [x] 发送Ether交易
- [x] 部署简单智能合约
- [x] 调用合约方法并查看事件
- [x] 使用curl调用RPC接口
- [x] 使用Web3.js连接节点

### 9.2 遇到的问题与解决

| 问题描述 | 解决方案 | 经验总结 |
|---------|---------|---------|
| _填写问题1_ | _解决方法_ | _经验教训_ |
| _填写问题2_ | _解决方法_ | _经验教训_ |

### 9.3 实践心得

**关键收获：**
1. _填写你对Geth架构的理解_
2. _填写对区块链工作原理的认识_
3. _填写对智能合约部署流程的掌握_

**技能提升：**
- _如：掌握了Geth命令行操作_
- _如：理解了交易生命周期_
- _如：学会了调试智能合约_

**改进建议：**
- _对本次实践的改进建议_
- _对课程的建议_

---

## 十、附录

### 附录A：所有截图清单

| 截图编号 | 说明 | 文件名 |
|---------|------|--------|
| 截图1 | 环境验证 | env-check.png |
| 截图2 | 源码克隆成功 | git-clone.png |
| 截图3 | 编译成功输出 | build-success.png |
| 截图4 | Geth版本信息 | geth-version.png |
| 截图5 | 区块链初始化 | init-chain.png |
| 截图6 | 节点启动 | node-start.png |
| 截图7 | 基础查询 | basic-query.png |
| 截图8 | 挖矿测试 | mining-test.png |
| 截图9 | 创建账户 | create-account.png |
| 截图10 | 交易发送 | send-tx.png |
| 截图11 | 交易详情 | tx-details.png |
| 截图12 | 余额变化 | balance-change.png |
| 截图13 | 合约编译 | compile-contract.png |
| 截图14 | 合约部署 | deploy-contract.png |
| 截图15 | 合约地址 | contract-address.png |
| 截图16 | 合约调用 | call-contract.png |
| 截图17 | 事件日志 | event-logs.png |
| 截图18 | curl测试 | curl-rpc.png |
| 截图19 | Web3.js连接 | web3js-test.png |
| 截图20 | 区块浏览器 | block-explorer.png |
| 截图21 | 区块信息 | block-info.png |
| 截图22 | 交易信息 | tx-info.png |

### 附录B：配置文件

**genesis.json**
```json
[粘贴完整配置]
```

**启动脚本**
```bash
[粘贴完整启动脚本]
```

### 附录C：参考命令速查

**常用Geth命令：**
```bash
# 启动开发模式
geth --dev console

# 初始化私有链
geth --datadir ./mychain init genesis.json

# 连接到运行中的节点
geth attach http://127.0.0.1:8545
```

**常用控制台命令：**
```javascript
// 账户操作
eth.accounts
personal.newAccount("password")
eth.getBalance(address)

// 交易操作
eth.sendTransaction({from, to, value})
eth.getTransaction(txHash)

// 挖矿操作
miner.start()
miner.stop()

// 合约操作
eth.contract(abi)
contract.new({from, data, gas})
contract.methods.functionName()
```

---

**评分总结：**

| 项目 | 分值 | 得分 |
|------|------|------|
| 编译Geth | 10 | _待评_ |
| 搭建私有链 | 20 | _待评_ |
| 控制台操作 | 30 | _待评_ |
| 交易操作 | 20 | _待评_ |
| 智能合约部署 | 20 | _待评_ |
| 外部工具连接 | 10 | _待评_ |
| 区块浏览器查询 | 10 | _待评_ |
| **总计** | **120** | _待评_ |

**评语：**  
_教师评语区域_

---

**提交日期：** _填写_  
**学号：** _填写_  
**姓名：** _填写_  
